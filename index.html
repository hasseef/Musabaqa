import React, { useMemo, useState } from "react";

// -------------------------------------------------------------
// MUSABAQA â€“ Single-file Interactive Prototype
// Landing + Individual + Gov/Nonprofit + Sponsor + Admin + Investor
// -------------------------------------------------------------
// Notes:
// - Pure React with Tailwind classes for quick prototyping.
// - All data is in-memory; refresh resets the state.
// - Purpose: demo flows for partners/investors & realistic UX feel.
// -------------------------------------------------------------

// Helpers
const currency = (n) => new Intl.NumberFormat("ar-SA", { style: "currency", currency: "SAR" }).format(n);
const fmt = (n) => new Intl.NumberFormat("ar-SA").format(n);

// Seed competitions & users
const seedCompetitions = [
  {
    id: "c1",
    title: "Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø¨Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø±Ù‚Ù…ÙŠ",
    type: "ØªÙˆØ¹ÙˆÙŠØ©",
    ownerType: "gov",
    ownerName: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…",
    city: "Ø§Ù„Ø±ÙŠØ§Ø¶",
    prizeSAR: 1000,
    prizeType: "Ø±Ù‚Ù…ÙŠØ©",
    status: "Ù…ÙØªÙˆØ­Ø©",
    winnersCount: 3,
    participants: [],
    createdAt: Date.now() - 1000 * 60 * 60 * 24 * 6,
  },
  {
    id: "c2",
    title: "ØªØ­Ø¯ÙŠ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
    type: "ØªØ³ÙˆÙŠÙ‚ÙŠØ©",
    ownerType: "sponsor",
    ownerName: "Ø´Ø±ÙƒØ© ØªÙ…ÙˆÙŠÙ† Ø§Ù„ØºØ°Ø§Ø¡",
    city: "Ø¬Ø¯Ø©",
    prizeSAR: 5000,
    prizeType: "Ø¹ÙŠÙ†ÙŠØ©",
    status: "Ù…ÙØªÙˆØ­Ø©",
    winnersCount: 1,
    participants: [],
    createdAt: Date.now() - 1000 * 60 * 60 * 24 * 2,
  },
  {
    id: "c3",
    title: "Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¦Ø© â€“ ÙÙƒØ±Ø© Ù…Ø¨ØªÙƒØ±Ø© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø±",
    type: "ØªÙˆØ¹ÙˆÙŠØ©",
    ownerType: "gov",
    ownerName: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ¦Ø©",
    city: "Ø§Ù„Ø¯Ù…Ø§Ù…",
    prizeSAR: 3000,
    prizeType: "Ù†Ù‚Ø¯ÙŠØ©",
    status: "Ù…ØºÙ„Ù‚Ø©",
    winnersCount: 2,
    participants: [
      { user: "Ø³Ø§Ø±Ø©" , city: "Ø§Ù„Ø±ÙŠØ§Ø¶", answer: "ØªØ·Ø¨ÙŠÙ‚ Ø°ÙƒÙŠ Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙØ§Ø¦Ø¶" },
      { user: "Ø®Ø§Ù„Ø¯" , city: "Ø§Ù„Ø¯Ù…Ø§Ù…", answer: "Ø­Ø§ÙˆÙŠØ§Øª Ø°ÙƒÙŠØ© Ù„Ù„ÙØ±Ø²" }
    ],
    createdAt: Date.now() - 1000 * 60 * 60 * 24 * 10,
  }
];

const seedUsers = {
  individual: { name: "ÙÙ‡Ø¯", city: "Ø§Ù„Ø±ÙŠØ§Ø¶", interests: ["Ø§Ù„Ø«Ù‚Ø§ÙØ©","Ø§Ù„ØªÙ‚Ù†ÙŠØ©","Ø§Ù„Ø±ÙŠØ§Ø¶Ø©"] },
  entity: { name: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠ", org: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" },
  sponsor: { name: "Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚", org: "Ø´Ø±ÙƒØ© ØªÙ…ÙˆÙŠÙ† Ø§Ù„ØºØ°Ø§Ø¡", wallet: 25000 },
  admin: { name: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…" },
  investor: { name: "Ù…Ø³ØªØ«Ù…Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ" }
};

// UI primitives
const Pill = ({ children }) => (
  <span className="px-2 py-1 text-xs rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200">{children}</span>
);

const Card = ({ children, className = "" }) => (
  <div className={`bg-white rounded-2xl shadow-sm border border-gray-100 p-5 ${className}`}>{children}</div>
);

const Stat = ({ label, value, sub }) => (
  <Card>
    <div className="text-2xl font-bold">{value}</div>
    <div className="text-gray-500 text-sm">{label}</div>
    {sub && <div className="text-gray-400 text-xs mt-1">{sub}</div>}
  </Card>
);

const SectionTitle = ({ children, action }) => (
  <div className="flex items-center justify-between mb-3">
    <h3 className="text-lg font-semibold">{children}</h3>
    {action}
  </div>
);

// Landing
function Landing({ kpis, onSelectAccount }) {
  return (
    <div className="max-w-6xl mx-auto p-6">
      {/* Hero */}
      <div className="grid md:grid-cols-2 gap-6 items-center">
        <div>
          <h1 className="text-3xl md:text-4xl font-extrabold leading-snug">
            Ù…Ø³Ø§Ø¨Ù‚Ø© â€” Ø­ÙˆÙ„ Ø¬Ù…Ù‡ÙˆØ±Ùƒ Ø¥Ù„Ù‰ <span className="text-indigo-600">Ù…ØªÙØ§Ø¹Ù„ÙŠÙ† ÙØ¹Ù„ÙŠÙ‹Ø§</span>
          </h1>
          <p className="text-gray-600 mt-3">
            Ù…Ù†ØµØ© ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙˆØ¹ÙˆÙŠØ© ÙˆØ§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© ØªØ±Ø¨Ø· Ø§Ù„ØªØ­ÙÙŠØ² Ø¨Ø§Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø£Ø«Ø±.
          </p>
          <div className="flex flex-wrap gap-2 mt-4">
            <button className="btn" onClick={() => onSelectAccount("individual")}>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ (ÙØ±Ø¯)</button>
            <button className="btn-outline" onClick={() => onSelectAccount("entity")}>Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©/ØºÙŠØ± Ø§Ù„Ø±Ø¨Ø­ÙŠØ©</button>
            <button className="btn-outline" onClick={() => onSelectAccount("sponsor")}>Ù„Ù„Ø±Ø¹Ø§Ø© ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª</button>
            <button className="btn-ghost" onClick={() => onSelectAccount("investor")}>
              Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±
            </button>
          </div>
          <div className="flex gap-2 mt-4">
            <Pill>RTL</Pill>
            <Pill>ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØ§Ø¹Ù„ÙŠØ©</Pill>
            <Pill>Ù…Ø­ÙØ¸Ø© Ø±Ù‚Ù…ÙŠØ©</Pill>
            <Pill>Ø¬ÙˆØ§Ø¦Ø² Ù†Ù‚Ø¯ÙŠØ©/Ø±Ù‚Ù…ÙŠØ©/Ø¹ÙŠÙ†ÙŠØ©</Pill>
          </div>
        </div>
        <Card>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
            <Stat label="Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©" value={fmt(kpis.active)} />
            <Stat label="Ù…Ø´Ø§Ø±ÙƒØ§Øª" value={fmt(kpis.participations)} />
            <Stat label="Ø¬ÙˆØ§Ø¦Ø² Ù…ÙØ³Ù„Ù‘ÙÙ…Ø©" value={fmt(kpis.prizes)} />
            <Stat label="Ø±Ø¹Ø§Ø© Ù†Ø´Ø·ÙˆÙ†" value={fmt(kpis.sponsors)} />
            <Stat label="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²" value={currency(kpis.prizeValue)} />
            <Stat label="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†" value={fmt(kpis.users)} />
          </div>
        </Card>
      </div>

      {/* Accounts strip */}
      <SectionTitle>Ù…Ù† ÙŠØ®Ø¯Ù…Ù‡Ù… Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ</SectionTitle>
      <div className="grid md:grid-cols-5 gap-3">
        {[
          {k:"individual",t:"Ø§Ù„Ø£ÙØ±Ø§Ø¯",d:"Ù…Ø´Ø§Ø±ÙƒØ©/Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø¬ÙˆØ§Ø¦Ø²"},
          {k:"entity",t:"Ø¬Ù‡Ø§Øª Ø­ÙƒÙˆÙ…ÙŠØ©/ØºÙŠØ± Ø±Ø¨Ø­ÙŠØ©",d:"Ø¥Ø·Ù„Ø§Ù‚ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª ØªÙˆØ¹ÙˆÙŠØ© ÙˆØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø«Ø±"},
          {k:"sponsor",t:"Ø§Ù„Ø´Ø±ÙƒØ§Øª/Ø§Ù„Ø±Ø¹Ø§Ø©",d:"Ø±Ø¹Ø§ÙŠØ©/Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„ ROI"},
          {k:"admin",t:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ©",d:"Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŒ Ø¯Ø¹Ù…ØŒ Ù…Ø­Ø§ÙØ¸"},
          {k:"investor",t:"Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±",d:"Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ù†Ù…Ùˆ Ø§Ù„Ù…Ø§Ù„ÙŠ"}
        ].map((a)=> (
          <Card key={a.k} className="cursor-pointer hover:shadow-md" onClick={()=>onSelectAccount(a.k)}>
            <div className="font-semibold">{a.t}</div>
            <div className="text-sm text-gray-500 mt-1">{a.d}</div>
          </Card>
        ))}
      </div>

      {/* Logos */}
      <SectionTitle>Ø´Ø±ÙƒØ§Ø¡ ÙˆØªØ¬Ø§Ø±Ø¨</SectionTitle>
      <Card>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-gray-500">
          <div className="p-3 border rounded-xl">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© (ØªØ¬Ø±ÙŠØ¨ÙŠ)</div>
          <div className="p-3 border rounded-xl">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… (ØªØ¬Ø±ÙŠØ¨ÙŠ)</div>
          <div className="p-3 border rounded-xl">Ø´Ø±ÙƒØ© ØªÙ…ÙˆÙŠÙ† Ø§Ù„ØºØ°Ø§Ø¡</div>
          <div className="p-3 border rounded-xl">Ø¬Ø§Ù…Ø¹Ø© Ø­Ø§Ø¦Ù„</div>
        </div>
      </Card>
    </div>
  );
}

// Individual account
function Individual({ user, competitions, onParticipate }) {
  const [filter, setFilter] = useState("");
  const list = useMemo(()=> competitions.filter(c=> c.status!=="Ù…ØºÙ„Ù‚Ø©" && (filter? c.city===filter : true)), [competitions, filter]);
  const [answer, setAnswer] = useState("");

  return (
    <div className="max-w-5xl mx-auto p-6">
      <h2 className="text-2xl font-bold mb-4">Ù…Ø±Ø­Ø¨Ù‹Ø§ {user.name} ğŸ‘‹</h2>
      <div className="flex flex-wrap gap-2 mb-4 items-center">
        <Pill>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: {user.city}</Pill>
        <Pill>Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª: {user.interests.join("ØŒ ")}</Pill>
        <select className="input" value={filter} onChange={(e)=>setFilter(e.target.value)}>
          <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>
          <option>Ø§Ù„Ø±ÙŠØ§Ø¶</option>
          <option>Ø¬Ø¯Ø©</option>
          <option>Ø§Ù„Ø¯Ù…Ø§Ù…</option>
        </select>
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        {list.map(c => (
          <Card key={c.id}>
            <div className="flex items-center justify-between">
              <div className="font-semibold">{c.title}</div>
              <Pill>{c.type}</Pill>
            </div>
            <div className="text-sm text-gray-500 mt-1">{c.ownerName} â€¢ {c.city}</div>
            <div className="text-sm mt-2">Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: {currency(c.prizeSAR)} ({c.prizeType}) â€¢ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†: {c.winnersCount}</div>
            <textarea className="textarea mt-3" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ/Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ø¥ÙŠØ¬Ø§Ø²" value={answer} onChange={(e)=>setAnswer(e.target.value)} />
            <div className="flex gap-2 mt-2">
              <button className="btn" onClick={()=>{onParticipate(c.id, user.name, user.city, answer); setAnswer("");}}>Ø£Ø´Ø§Ø±Ùƒ Ø§Ù„Ø¢Ù†</button>
              <button className="btn-ghost">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
}

// Entity (Gov/Nonprofit)
function Entity({ entityName, onCreate }) {
  const [form, setForm] = useState({ title:"", type:"ØªÙˆØ¹ÙˆÙŠØ©", city:"Ø§Ù„Ø±ÙŠØ§Ø¶", prizeSAR:1000, prizeType:"Ø±Ù‚Ù…ÙŠØ©", winnersCount:1 });
  return (
    <div className="max-w-4xl mx-auto p-6">
      <h2 className="text-2xl font-bold mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø¬Ù‡Ø©: {entityName}</h2>
      <Card>
        <SectionTitle>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙˆØ¹ÙˆÙŠØ©</SectionTitle>
        <div className="grid md:grid-cols-2 gap-3">
          <input className="input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©" value={form.title} onChange={(e)=>setForm({...form, title:e.target.value})} />
          <select className="input" value={form.type} onChange={(e)=>setForm({...form, type:e.target.value})}>
            <option>ØªÙˆØ¹ÙˆÙŠØ©</option>
            <option>Ø«Ù‚Ø§ÙÙŠØ©</option>
            <option>ØªØ³ÙˆÙŠÙ‚ÙŠØ©</option>
          </select>
          <select className="input" value={form.city} onChange={(e)=>setForm({...form, city:e.target.value})}>
            <option>Ø§Ù„Ø±ÙŠØ§Ø¶</option>
            <option>Ø¬Ø¯Ø©</option>
            <option>Ø§Ù„Ø¯Ù…Ø§Ù…</option>
          </select>
          <input className="input" type="number" min={1} placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†" value={form.winnersCount} onChange={(e)=>setForm({...form, winnersCount: Number(e.target.value)})} />
          <input className="input" type="number" min={0} placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© (Ø±ÙŠØ§Ù„)" value={form.prizeSAR} onChange={(e)=>setForm({...form, prizeSAR: Number(e.target.value)})} />
          <select className="input" value={form.prizeType} onChange={(e)=>setForm({...form, prizeType:e.target.value})}>
            <option>Ø±Ù‚Ù…ÙŠØ©</option>
            <option>Ù†Ù‚Ø¯ÙŠØ©</option>
            <option>Ø¹ÙŠÙ†ÙŠØ©</option>
          </select>
        </div>
        <div className="flex gap-2 mt-3">
          <button className="btn" onClick={()=> onCreate(form)}>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
          <button className="btn-ghost">Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
        </div>
      </Card>
    </div>
  );
}

// Sponsor
function Sponsor({ sponsor, onCreate, onFund, competitions }) {
  const [form, setForm] = useState({ title:"Ø­Ù…Ù„Ø© ØªØ±ÙˆÙŠØ¬ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©", type:"ØªØ³ÙˆÙŠÙ‚ÙŠØ©", city:"Ø§Ù„Ø±ÙŠØ§Ø¶", prizeSAR:2000, prizeType:"Ø±Ù‚Ù…ÙŠØ©", winnersCount:1 });
  const open = competitions.filter(c=> c.status === "Ù…ÙØªÙˆØ­Ø©");
  const [fundAmount, setFundAmount] = useState(1000);

  return (
    <div className="max-w-5xl mx-auto p-6">
      <h2 className="text-2xl font-bold mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø§Ø¹ÙŠ: {sponsor.org}</h2>
      <div className="grid md:grid-cols-3 gap-4">
        <Stat label="Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©" value={currency(sponsor.wallet)} sub="ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ø§Ø­Ù‚Ù‹Ø§" />
        <Stat label="Ø­Ù…Ù„Ø§Øª Ù…ÙØªÙˆØ­Ø© Ù„Ù„Ø±Ø¹Ø§ÙŠØ©" value={open.length} />
        <Stat label="Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²" value={currency(Math.round(open.reduce((a,c)=>a+c.prizeSAR,0)/(open.length||1)))} />
      </div>

      <div className="grid md:grid-cols-2 gap-4 mt-4">
        <Card>
          <SectionTitle>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ©</SectionTitle>
          <div className="grid grid-cols-2 gap-3">
            <input className="input col-span-2" value={form.title} onChange={(e)=>setForm({...form, title:e.target.value})} />
            <select className="input" value={form.type} onChange={(e)=>setForm({...form, type:e.target.value})}>
              <option>ØªØ³ÙˆÙŠÙ‚ÙŠØ©</option>
              <option>Ø«Ù‚Ø§ÙÙŠØ©</option>
            </select>
            <select className="input" value={form.city} onChange={(e)=>setForm({...form, city:e.target.value})}>
              <option>Ø§Ù„Ø±ÙŠØ§Ø¶</option>
              <option>Ø¬Ø¯Ø©</option>
              <option>Ø§Ù„Ø¯Ù…Ø§Ù…</option>
            </select>
            <input className="input" type="number" value={form.winnersCount} onChange={(e)=>setForm({...form, winnersCount: Number(e.target.value)})} />
            <input className="input" type="number" value={form.prizeSAR} onChange={(e)=>setForm({...form, prizeSAR: Number(e.target.value)})} />
            <select className="input" value={form.prizeType} onChange={(e)=>setForm({...form, prizeType:e.target.value})}>
              <option>Ø±Ù‚Ù…ÙŠØ©</option>
              <option>Ù†Ù‚Ø¯ÙŠØ©</option>
              <option>Ø¹ÙŠÙ†ÙŠØ©</option>
            </select>
          </div>
          <div className="mt-3"><button className="btn" onClick={()=> onCreate(form, sponsor.org)}>Ø¥Ù†Ø´Ø§Ø¡</button></div>
        </Card>

        <Card>
          <SectionTitle>Ø±Ø¹Ø§ÙŠØ© Ù…Ø³Ø§Ø¨Ù‚Ø© Ù‚Ø§Ø¦Ù…Ø©</SectionTitle>
          <div className="space-y-3">
            {open.map(c=> (
              <div key={c.id} className="p-3 border rounded-xl flex items-center justify-between">
                <div>
                  <div className="font-semibold">{c.title}</div>
                  <div className="text-xs text-gray-500">{c.ownerName} â€¢ {c.city}</div>
                </div>
                <div className="flex items-center gap-2">
                  <input className="input w-28" type="number" min={100} value={fundAmount} onChange={(e)=>setFundAmount(Number(e.target.value))} />
                  <button className="btn" onClick={()=> onFund(c.id, fundAmount)}>ØªÙ…ÙˆÙŠÙ„</button>
                </div>
              </div>
            ))}
          </div>
        </Card>
      </div>
    </div>
  );
}

// Admin
function Admin({ competitions, onApprove, onClose, onPickWinners }) {
  return (
    <div className="max-w-6xl mx-auto p-6">
      <h2 className="text-2xl font-bold mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
      <div className="grid md:grid-cols-2 gap-4">
        {competitions.map(c => (
          <Card key={c.id}>
            <div className="flex items-center justify-between">
              <div className="font-semibold">{c.title}</div>
              <Pill>{c.status}</Pill>
            </div>
            <div className="text-sm text-gray-500 mt-1">{c.ownerName} â€¢ {c.type} â€¢ {c.city}</div>
            <div className="text-sm mt-2">Ù…Ø´Ø§Ø±ÙƒÙˆÙ†: {c.participants.length} â€¢ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: {currency(c.prizeSAR)} â€¢ ÙØ§Ø¦Ø²ÙˆÙ†: {c.winnersCount}</div>
            <div className="flex gap-2 mt-3">
              {c.status === "Ù…Ø³ÙˆØ¯Ø©" && <button className="btn" onClick={()=> onApprove(c.id)}>Ø§Ø¹ØªÙ…Ø§Ø¯</button>}
              {c.status !== "Ù…ØºÙ„Ù‚Ø©" && <button className="btn-outline" onClick={()=> onClose(c.id)}>Ø¥ØºÙ„Ø§Ù‚</button>}
              <button className="btn-ghost" onClick={()=> onPickWinners(c.id)}>ÙØ±Ø² Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</button>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
}

// Investor
function Investor({ competitions, totalUsers, revenue, sponsorsCount }) {
  const totalPrizes = competitions.reduce((a,c)=> a + c.prizeSAR, 0);
  const active = competitions.filter(c=> c.status!=="Ù…ØºÙ„Ù‚Ø©");
  const monthlyGrowth = 12; // mock %
  const ar = (n)=> `${n}%`;

  return (
    <div className="max-w-5xl mx-auto p-6">
      <h2 className="text-2xl font-bold mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±</h2>
      <div className="grid md:grid-cols-3 gap-4">
        <Stat label="Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†" value={fmt(totalUsers)} sub={"Ù†Ù…Ùˆ Ø´Ù‡Ø±ÙŠ " + ar(monthlyGrowth)} />
        <Stat label="Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø´Ù‡Ø±ÙŠØ©" value={currency(revenue)} sub="ØªØ±Ø§ÙƒÙ…ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ" />
        <Stat label="Ø±Ø¹Ø§Ø© Ù†Ø´Ø·ÙˆÙ†" value={fmt(sponsorsCount)} />
      </div>
      <Card className="mt-4">
        <SectionTitle>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</SectionTitle>
        <div className="grid md:grid-cols-2 gap-4">
          <Stat label="Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ù†Ø´Ø·Ø©" value={active.length} />
          <Stat label="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©" value={currency(totalPrizes)} />
        </div>
        <div className="text-sm text-gray-600 mt-3">
          * Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø§ÙƒØ§Ø© Ù„ØºØ±Ø¶ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· â€” ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù…ØµØ¯Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§.
        </div>
      </Card>
    </div>
  );
}

export default function App() {
  const [route, setRoute] = useState("landing");
  const [competitions, setCompetitions] = useState(seedCompetitions);
  const [users, setUsers] = useState(seedUsers);

  // KPIs
  const kpis = useMemo(()=>({
    active: competitions.filter(c=>c.status!=="Ù…ØºÙ„Ù‚Ø©").length,
    participations: competitions.reduce((a,c)=> a + c.participants.length, 0),
    prizes: competitions.filter(c=>c.status==="Ù…ØºÙ„Ù‚Ø©").reduce((a,c)=> a + c.winnersCount, 0),
    sponsors: 7,
    prizeValue: competitions.reduce((a,c)=> a + c.prizeSAR, 0),
    users: 58000
  }), [competitions]);

  // Actions
  const participate = (cid, user, city, answer) => {
    if(!answer) return alert("ÙØ¶Ù„Ø§Ù‹ Ø§ÙƒØªØ¨ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
    setCompetitions(prev => prev.map(c => c.id===cid ? { ...c, participants: [...c.participants, { user, city, answer }] } : c));
    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
  };

  const createByEntity = (form) => {
    const id = `c${Date.now()}`;
    const entry = {
      id,
      title: form.title || "Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
      type: form.type,
      ownerType: "gov",
      ownerName: users.entity.org,
      city: form.city,
      prizeSAR: form.prizeSAR,
      prizeType: form.prizeType,
      status: "Ù…ÙØªÙˆØ­Ø©",
      winnersCount: form.winnersCount,
      participants: [],
      createdAt: Date.now()
    };
    setCompetitions([entry, ...competitions]);
    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆÙ†Ø´Ø±Ù‡Ø§ âœ…");
  };

  const sponsorCreate = (form, org) => {
    const id = `c${Date.now()}`;
    const entry = {
      id,
      title: form.title,
      type: form.type,
      ownerType: "sponsor",
      ownerName: org,
      city: form.city,
      prizeSAR: form.prizeSAR,
      prizeType: form.prizeType,
      status: "Ù…ÙØªÙˆØ­Ø©",
      winnersCount: form.winnersCount,
      participants: [],
      createdAt: Date.now()
    };
    setCompetitions([entry, ...competitions]);
    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© âœ…");
  };

  const sponsorFund = (cid, amount) => {
    if(amount <= 0) return;
    setUsers(u => ({...u, sponsor: {...u.sponsor, wallet: Math.max(0, u.sponsor.wallet - amount)}}));
    setCompetitions(prev => prev.map(c => c.id===cid ? { ...c, prizeSAR: c.prizeSAR + amount } : c));
    alert("ØªÙ… Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© âœ…");
  };

  const approve = (cid) => {
    setCompetitions(prev => prev.map(c => c.id===cid ? { ...c, status: "Ù…ÙØªÙˆØ­Ø©" } : c));
  };

  const closeComp = (cid) => {
    setCompetitions(prev => prev.map(c => c.id===cid ? { ...c, status: "Ù…ØºÙ„Ù‚Ø©" } : c));
  };

  const pickWinners = (cid) => {
    setCompetitions(prev => prev.map(c => {
      if(c.id!==cid) return c;
      const shuffled = [...c.participants].sort(()=> Math.random()-0.5);
      const winners = shuffled.slice(0, c.winnersCount);
      alert(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${winners.length} ÙØ§Ø¦Ø²/Ø©:\n` + winners.map(w=>`â€¢ ${w.user} (${w.city})`).join("\n"));
      return c;
    }));
  };

  // Layout
  return (
    <div dir="rtl" className="min-h-screen bg-gradient-to-b from-indigo-50 to-white">
      {/* Top Nav */}
      <div className="sticky top-0 z-10 backdrop-blur bg-white/70 border-b">
        <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3 justify-between">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 rounded-2xl bg-indigo-600" />
            <span className="font-bold">Ù…Ø³Ø§Ø¨Ù‚Ø©</span>
          </div>
          <div className="flex flex-wrap gap-2">
            <button className={`tab ${route==='landing'?'tab-active':''}`} onClick={()=>setRoute("landing")}>Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</button>
            <button className={`tab ${route==='individual'?'tab-active':''}`} onClick={()=>setRoute("individual")}>ÙØ±Ø¯</button>
            <button className={`tab ${route==='entity'?'tab-active':''}`} onClick={()=>setRoute("entity")}>Ø¬Ù‡Ø©</button>
            <button className={`tab ${route==='sponsor'?'tab-active':''}`} onClick={()=>setRoute("sponsor")}>Ø±Ø§Ø¹Ù</button>
            <button className={`tab ${route==='admin'?'tab-active':''}`} onClick={()=>setRoute("admin")}>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
            <button className={`tab ${route==='investor'?'tab-active':''}`} onClick={()=>setRoute("investor")}>Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±</button>
          </div>
          <div>
            <button className="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
          </div>
        </div>
      </div>

      {/* Routes */}
      {route === "landing" && <Landing kpis={kpis} onSelectAccount={setRoute} />}
      {route === "individual" && (
        <Individual user={users.individual} competitions={competitions} onParticipate={participate} />
      )}
      {route === "entity" && (
        <Entity entityName={`${users.entity.org} â€“ ${users.entity.name}`} onCreate={createByEntity} />
      )}
      {route === "sponsor" && (
        <Sponsor sponsor={users.sponsor} competitions={competitions} onCreate={sponsorCreate} onFund={sponsorFund} />
      )}
      {route === "admin" && (
        <Admin competitions={competitions} onApprove={approve} onClose={closeComp} onPickWinners={pickWinners} />
      )}
      {route === "investor" && (
        <Investor competitions={competitions} totalUsers={kpis.users} revenue={185000} sponsorsCount={kpis.sponsors} />
      )}

      {/* Footer */}
      <div className="mt-12 border-t bg-white/70">
        <div className="max-w-7xl mx-auto px-4 py-6 text-sm text-gray-500 flex flex-wrap gap-3 items-center justify-between">
          <div>Â© {new Date().getFullYear()} Musabaqa â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</div>
          <div className="flex gap-4">
            <a className="link" href="#">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
            <a className="link" href="#">Ø§Ù„Ø´Ø±ÙˆØ·</a>
            <a className="link" href="#">Ø§Ù„Ø¯Ø¹Ù…</a>
          </div>
        </div>
      </div>

      {/* Minimal Tailwind-like utilities */}
      <style>{`
        .btn{ @apply px-4 py-2 rounded-xl bg-indigo-600 text-white text-sm hover:bg-indigo-700 transition; }
        .btn-outline{ @apply px-4 py-2 rounded-xl border border-indigo-600 text-indigo-700 text-sm hover:bg-indigo-50; }
        .btn-ghost{ @apply px-3 py-2 rounded-xl text-indigo-700 text-sm hover:bg-indigo-50; }
        .tab{ @apply px-3 py-1.5 rounded-xl text-sm text-gray-700 hover:bg-gray-100; }
        .tab-active{ @apply bg-gray-900 text-white; }
        .input{ @apply w-full px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200; }
        .textarea{ @apply w-full h-24 px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200; }
        .link{ @apply hover:text-gray-900; }
      `}</style>
      {/* NOTE: In the canvas preview Tailwind's @apply may not be processed.
               We inline a minimal fallback style below for reliable preview. */}
      <style>{`
        .btn{ padding:8px 16px; border-radius:12px; background:#4f46e5; color:#fff; font-size:14px; }
        .btn:hover{ background:#4338ca; }
        .btn-outline{ padding:8px 16px; border-radius:12px; border:1px solid #4f46e5; color:#4338ca; font-size:14px; }
        .btn-ghost{ padding:8px 12px; border-radius:12px; color:#4338ca; font-size:14px; }
        .tab{ padding:6px 12px; border-radius:10px; font-size:14px; color:#374151; }
        .tab-active{ background:#111827; color:#fff; }
        .input{ width:100%; padding:8px 12px; border:1px solid #e5e7eb; border-radius:12px; font-size:14px; }
        .textarea{ width:100%; height:100px; padding:8px 12px; border:1px solid #e5e7eb; border-radius:12px; font-size:14px; }
        .link{ color:#6b7280; text-decoration:none; }
        .link:hover{ color:#111827; }
      `}</style>
    </div>
  );
}
