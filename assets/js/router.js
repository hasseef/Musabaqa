
const routes=new Map(); export const route=(p,l)=>routes.set(p,l); export const startRouter=()=>{ addEventListener('hashchange',render); document.addEventListener('DOMContentLoaded',render); };
export async function render(){ const outlet=document.getElementById('app'); const path=location.hash.replace(/^#/,'')||'/'; const [routePath,...rest]=path.split('/').filter(Boolean); const key='/'+(routePath??''); const loader=routes.get(key)||routes.get('*'); try{ outlet.innerHTML='<div class="card" aria-busy="true">جارٍ التحميل…</div>'; const html=await loader(rest); outlet.innerHTML=html; outlet.focus({preventScroll:false}); updateBN(); }catch(err){ outlet.innerHTML=`<div class="card"><h3>خطأ</h3><p class="muted">${err.message}</p></div>`; } }
export function updateBN(){ const h=location.hash; const ids=['bn-home','bn-comps','bn-dash','bn-prof']; ids.forEach(id=>document.getElementById(id)?.classList.remove('active')); if(h.startsWith('#/competitions')) document.getElementById('bn-comps')?.classList.add('active'); else if(h.startsWith('#/dashboard')) document.getElementById('bn-dash')?.classList.add('active'); else if(h.startsWith('#/profile')) document.getElementById('bn-prof')?.classList.add('active'); else document.getElementById('bn-home')?.classList.add('active'); }